NAME triazolamerN
TYPES TRIAZOLAMERN

## general requirements for this patch

BEGIN_SELECTOR
NOT PROPERTY DNA
NOT PROPERTY RNA
NOT PROPERTY CARBOHYDRATE
NOT PROPERTY METAL
PROPERTY PROTEIN TERMINUS
NOT VARIANT_TYPE A3B_HBS_PRE
NOT VARIANT_TYPE A3B_HBS_POST
NOT VARIANT_TYPE HBS_POST
NOT VARIANT_TYPE HBS_PRE
NOT VARIANT_TYPE OOP_PRE
NOT VARIANT_TYPE OOP_POST
NOT PROPERTY PHOSPHONATE
NOT VARIANT_TYPE CUTPOINT_UPPER
# not impossible but future work
NOT VARIANT_TYPE N_ACETYLATION 
NOT VARIANT_TYPE N_FORMYLATION
NOT VARIANT_TYPE METHYLATED_NTERM_VARIANT 
NOT VARIANT_TYPE ACETYLATED_NTERMINUS_VARIANT
NOT VARIANT_TYPE LOWER_TERMINUS_VARIANT
NOT PROPERTY PNA

# Exclude secondary amines
NOT VARIANT_TYPE HYDROXYLATION1 # PRO variants that resist selection by NAME3
NOT VARIANT_TYPE HYDROXYLATION2 # PRO variants that resist selection by NAME3
NOT AA PRO
NOT AA DPR
NOT NAME3 DPR
NOT NAME3 HPR
NOT NAME3 0AZ
NOT NAME3 HYP
NOT NAME3 B3P
NOT NAME3 B19
NOT NAME3 C89
NOT NAME3 B59
NOT NAME3 HYP
NOT NAME3 0AZ
NOT NAME3 TES # Too many atoms! Has a CT1 and stuff.
NOT NAME3 S56 # Too many atoms! Has a CT1 and stuff.
END_SELECTOR

## now we search for a case that matches the residue, take the first one
## so put generic case last

# For NME
BEGIN_CASE

BEGIN_SELECTOR
#NAME3 NME
PROPERTY TERMINUS
END_SELECTOR

ADD_ATOM VCT1 VIRT VIRT  0.00
ADD_ATOM  NT1 Nhis NR2  -0.31
ADD_ATOM  NT2 Nhis NZ2  -0.47
ADD_ATOM  NT3 Nhis NZ1  -0.47
ADD_BOND CH3 NT1
ADD_BOND NT1 NT2
ADD_BOND NT2 NT3
ADD_BOND NT3 VCT1

# To be totally general, we want to replace our mainchain atom by name not number
# (because for some relevant residue types, maybe e.g. C is mainchain atom number 17)
REPLACE_MAINCHAIN_ATOM	N	NT1
#SET_POLYMER_CONNECT LOWER NT1

ADD_CONNECT NT3 ICOOR	 0.000000	70.700000	1.347000  NT3	NT2	NT1

SET_ATOM_TYPE     N VIRT
SET_MM_ATOM_TYPE  N VIRT
SET_ATOMIC_CHARGE N 0.00

# Bit of a hack - but some residue types have icoords which depend on H.
SET_ATOM_TYPE     H VIRT
SET_MM_ATOM_TYPE  H VIRT
SET_ATOMIC_CHARGE H 0.00

# Fix these based on where the C and N would still be!!
SET_ICOOR NT1     0.000000	69.900000	1.459211  CH3	1HH3	 N
SET_ICOOR NT2   -97.400000	70.300000	1.347000  NT1	 CH3	1HH3
SET_ICOOR NT3   177.000000	72.300000	1.347000  NT2	 NT1	 CH3
SET_ICOOR LOWER	  0.000000	70.600000	1.347000  NT1	 NT2	 NT3
SET_ICOOR VCT1    0.000000	70.700000	1.347000  NT3	 NT2	 NT1

# Will cause
# ERROR: Residue::conect_atom: I'm not bonded to that other residue!!
# ERROR:: Exit from: src/core/conformation/Residue.cc line: 1116
# due to branch_connection_torsion_angle_atoms
#ADD_PROPERTY BRANCH_POINT

END_CASE


BEGIN_CASE

BEGIN_SELECTOR
PROPERTY PROTEIN
END_SELECTOR

ADD_ATOM VCT1 VIRT VIRT  0.00
ADD_ATOM  NT1 Nhis NR2  -0.31
ADD_ATOM  NT2 Nhis NZ2  -0.47
ADD_ATOM  NT3 Nhis NZ1  -0.47
ADD_BOND CA  NT1
ADD_BOND NT1 NT2
ADD_BOND NT2 NT3
ADD_BOND NT3 VCT1

# To be totally general, we want to replace our mainchain atom by name not number
# (because for some relevant residue types, maybe e.g. C is mainchain atom number 17)
REPLACE_MAINCHAIN_ATOM	N	NT1
#SET_POLYMER_CONNECT LOWER NT1

ADD_CONNECT NT3 ICOOR	 0.000000	70.700000	1.347000  NT3	NT2	NT1

SET_ATOM_TYPE     N VIRT
SET_MM_ATOM_TYPE  N VIRT
SET_ATOMIC_CHARGE N 0.00

# Bit of a hack - but some residue types have icoords which depend on H.
SET_ATOM_TYPE     H VIRT
SET_MM_ATOM_TYPE  H VIRT
SET_ATOMIC_CHARGE H 0.00

# Fix these based on where the C and N would still be!!
SET_ICOOR NT1     0.000000	69.900000	1.459211  CA	C	N
SET_ICOOR NT2   -97.400000	70.300000	1.347000  NT1	CA	C
SET_ICOOR NT3   177.000000	72.300000	1.347000  NT2	NT1	CA
SET_ICOOR LOWER	  0.000000	70.600000	1.347000  NT1	NT2	NT3
SET_ICOOR VCT1    0.000000	70.700000	1.347000  NT3	NT2	NT1
SET_POLYMER_CONNECT LOWER NT1

# Will cause
# ERROR: Residue::conect_atom: I'm not bonded to that other residue!!
# ERROR:: Exit from: src/core/conformation/Residue.cc line: 1116
# due to branch_connection_torsion_angle_atoms
#ADD_PROPERTY BRANCH_POINT

END_CASE
